
<style>
  .image-gallery-p {overflow: auto; margin-left: -1%!important;}
  .image-gallery-p a {float: left; display: block; margin: 0 0 1% 1%; width: 49%; text-align: center; text-decoration: none!important;}
  .image-gallery-p a span {display: block; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; padding: 3px 0;}
  .image-gallery-p a img {width: 100%; display: block;}
</style>

<div class="image-gallery-p">
<!-- File Filter List (in Priority Order) -->
{% assign file_targets = ".stl,.kicad_sch,.kicad_pcb,.html,.png,.pdf" | split: "," -%}

<!-- Primary Search Loop -->
{% for target in file_targets -%}
	{% for file in site.data.repoFiles[i].files -%}
		{% assign filenameparts = file.path | split: "/" -%}
		{% assign extname = filenameparts | last | split: "." | last | prepend: "." -%}
		{% assign filename = filenameparts | last | replace: extname,"" -%}
		{% if extname == target and file.path contains "hardware/" -%}
			<!-- Default Targets -->
			{% capture href_target %}https://raw.githubusercontent.com/Matt-Santos/{{ site.data.repoData[i].name }}/refs/heads/main/{{ file.path }}{% endcapture -%}
			{% assign img_ref = file.path | replace: extname,".png" -%}
			{% for file2 in site.data.repoFiles[i].files -%}
				{% if file2.path contains img_ref -%}
					{% capture image_src %}<img src="//images.weserv.nl/?url=raw.githubusercontent.com/Matt-Santos/{{ site.data.repoData[i].name }}/refs/heads/main/{{ file.path }}&w=400&h=400&output=jpg&q=50&fit=cover" alt="{{ filename }}" class="lightbox-image"/>{% endcapture -%}
					{% break -%}
				{% endif -%}
			{% endfor -%}
			

			<!-- Special Cases -->
			{% case target -%}
				{% when ".stl" -%}
					{% capture href_target %}todo{% endcapture -%}
				{% when ".kicad_sch" -%}
					{% capture href_target %}todo{% endcapture -%}
				{% when ".kicad_pcb" -%}
					{% capture href_target %}todo{% endcapture -%}
				{% when ".html" -%}
					{% capture href_target %}#" onclick="replacePageContent('{{ href_target }}'); return false;{% endcapture -%}
				{% when ".pdf" -%}
					{% capture href_target %}https://docs.google.com/viewer?url=https://raw.githubusercontent.com/Matt-Santos/{{ site.data.repoData[i].name }}/refs/heads/main/{{ file.path }}{% endcapture -%}
			{% endcase -%}
			
			<!-- Create Entry -->
			<a href="{{ href_target }}" title="{{ filename }}">
				{{ image_src }}
			{% if image_src == nil -%}
				<img src="/assets/images/img_404.jpg" />
			{% endif -%}
				<span>{{ filename }}{{ extname }}</span>
			</a>
			{% assign image_src = nil -%}
		{% endif -%}
	{% endfor -%}
{% endfor -%}
</div>

<script>
async function replacePageContent(url) {
	try {
		const response = await fetch(url);
		if (!response.ok) throw new Error(`Failed to fetch: ${response.statusText}`);
		const newContent = await response.text();
		const tempDiv = document.createElement("div");
		tempDiv.innerHTML = newContent;
		const originalOnload = window.onload;
		let newOnload = null;
		const scripts = tempDiv.querySelectorAll("script");
		for (const script of scripts) {
			const newScript = document.createElement("script");
			if (script.src) {
				newScript.src = script.src;
				newScript.async = false;
			} 
			else {
				newScript.textContent = script.textContent;
				const onloadMatch = script.textContent.match(/window\.onload\s*=\s*function\s*\(\)\s*{([\s\S]*?)}/);
				if (onloadMatch && onloadMatch[1]) {
					newOnload = new Function(onloadMatch[1].trim());
				}
			}
			document.body.appendChild(newScript);
		}
		document.documentElement.innerHTML = tempDiv.innerHTML;
		if (newOnload) {
			window.onload = newOnload;
		} 
		else if (originalOnload) {
			window.onload = originalOnload;
		}
		if (typeof window.onload === "function") {
			window.onload();
		}
	}
	catch (error) {
		console.error("Error replacing page content:", error);
	}
}
</script>